# テトリスゲーム

## 概要

モダンで公式仕様（Tetris Guideline）に準拠したウェブブラウザで動作する本格的なテトリスゲームを作成する。

## 背景・目的

- ウェブブラウザで軽快に動作するテトリスゲームを提供
- Tetris Guideline（2001年以降の公式ルール）に準拠した本格的なゲーム体験
- 60fps 安定動作によるスムーズなプレイ

## 要件

### 機能要件

#### コアゲームプレイ
- **ブロック操作**: 左右移動、ソフトドロップ、ハードドロップ、回転（時計回り・反時計回り）
- **SRS（Super Rotation System）**: 公式の回転システム、壁蹴り（Wall Kick）対応
- **ライン消去**: 1〜4ライン同時消去、T-Spin 判定
- **7-bag ランダマイザ**: 7種のテトリミノを1セットとしてシャッフル

#### ゲーム機能
- **NEXT 表示**: 次の6個のテトリミノを表示
- **Hold 機能**: 現在のテトリミノを保持、1回のみ交換可能
- **ゴーストピース**: 落下位置のプレビュー表示
- **レベルシステム**: ライン消去でレベルアップ、落下速度上昇
- **スコアリング**: ライン消去、T-Spin、コンボなどのスコア計算

#### 追加機能
- **ハイスコア保存**: localStorage に保存、ランキング表示
- **リプレイ機能**: 直近5ゲームを保存、再生可能
- **設定画面**: キーコンフィグ（将来的な拡張用）
- **統計情報**: プレイ時間、総ライン消去数、テトリス率など

### 非機能要件

- **パフォーマンス**: 60fps 安定動作
- **対応ブラウザ**: モダンブラウザ（Chrome, Firefox, Safari, Edge の最新版）
- **レスポンシブ**: デスクトップ画面に最適化（キーボード操作のみ）
- **操作遅延**: 入力から描画まで16ms以内

## 技術的決定事項

### 技術スタック
- **言語**: TypeScript（型安全性、保守性を重視）
- **レンダリング**: HTML5 Canvas API（ゲーム描画に最適）
- **ビルドツール**: Vite（高速な開発サーバー、軽量バンドル）
- **スタイル**: CSS（Canvas外のUI要素用）

### アーキテクチャ
- **ゲームループ**: requestAnimationFrame ベース
- **状態管理**: 純粋なクラスベース設計
- **データ永続化**: localStorage API

### UI/デザイン
- **スタイル**: モダンミニマル（シンプルで洗練されたUI）
- **カラースキーム**: ダークモード対応
- **サウンド**: なし（サイレント）

## アーキテクチャ

### コンポーネント構成

```
src/
├── main.ts              # エントリーポイント
├── game/
│   ├── Game.ts          # メインゲームクラス
│   ├── Board.ts         # ゲームボード（10x20 + バッファ）
│   ├── Tetromino.ts     # テトリミノ定義・操作
│   ├── SRS.ts           # Super Rotation System
│   └── Randomizer.ts    # 7-bag ランダマイザ
├── systems/
│   ├── InputHandler.ts  # キーボード入力管理
│   ├── ScoreManager.ts  # スコア・レベル管理
│   ├── GameLoop.ts      # ゲームループ制御
│   └── ReplaySystem.ts  # リプレイ記録・再生
├── rendering/
│   ├── Renderer.ts      # メインレンダラー
│   ├── BoardRenderer.ts # ボード描画
│   └── UIRenderer.ts    # UI要素描画
├── storage/
│   └── Storage.ts       # localStorage 管理
├── ui/
│   ├── Menu.ts          # メニュー画面
│   ├── Settings.ts      # 設定画面
│   └── Statistics.ts    # 統計画面
└── types/
    └── index.ts         # 型定義
```

### データフロー

```
Input → InputHandler → Game → Board/Tetromino → Renderer → Canvas
                         ↓
                    ScoreManager → Storage
                         ↓
                    ReplaySystem → Storage
```

## 実装ガイドライン

### 変更が必要なファイル/領域

新規プロジェクトのため、すべて新規作成。

### 考慮事項

#### パフォーマンス
- Canvas の部分更新で描画負荷軽減
- オブジェクトプールでGC負荷軽減
- 固定タイムステップでゲームロジック安定化

#### ゲームプレイ
- Lock Delay: 接地後0.5秒の猶予時間
- DAS（Delayed Auto Shift）: 長押し時の自動移動
- ARR（Auto Repeat Rate）: 自動移動の間隔

#### エッジケース
- 画面フォーカス喪失時の一時停止
- ブラウザタブ非アクティブ時の処理
- localStorage 容量超過時のハンドリング

## スコープ外

以下は今回の実装範囲に含めない:

- タッチ操作対応（キーボードのみ）
- マルチプレイヤー対戦
- オンラインランキング
- BGM・効果音
- モバイル対応
- i18n（国際化）

## Sub-Issues

### フェーズ 1: 基盤構築
- #2 - プロジェクト初期セットアップ (S)
- #3 - テトリミノ定義と7-bagランダマイザ (S)

### フェーズ 2: コア実装
- #4 - ゲームボードと基本描画 (M)
- #5 - テトリミノ移動・SRS回転システム (M)
- #6 - ライン消去とT-Spin判定 (M)
- #7 - スコア・レベルシステム (S)
- #8 - NEXT表示・Hold機能・ゴーストピース (M)

### フェーズ 3: UI/UX
- #9 - ゲームUI（メニュー・ポーズ・ゲームオーバー） (M)

### フェーズ 4: 追加機能
- #10 - ハイスコア保存・ランキング表示 (S)
- #11 - リプレイ記録・再生機能 (M)
- #12 - 設定画面・統計情報 (S)
